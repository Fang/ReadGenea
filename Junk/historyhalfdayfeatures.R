c0,diff(sign(diff(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90))) != 0,0)
c(0,diff(sign(diff(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90))) != 0,0)
ind =  c(0,diff(sign(diff(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90))) != 0,0) ; plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind =  c(0,diff(sign(diff(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90))) != 0.1,0) ; plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind
ind
ind =  c(0,diff(sign(diff(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90))) != 0.1,0) ; plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind =  c(0,diff(sign(diff(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90))) != 0,0) ; plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind
ind2 = ind
cumsum(ind2) - shift(cumsum(ind2), -3, fill="edge"
)
cumsum(ind2) - shift(cumsum(ind2), -4, fill="edge")
cumsum(ind2) - shift(cumsum(ind2), -5, fill="edge")
ind = (cumsum(ind2) - shift(cumsum(ind2), -5, fill="edge") < -2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = (cumsum(ind2) - shift(cumsum(ind2), -10, fill="edge") < -5)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = (cumsum(ind2) - shift(cumsum(ind2), -10, fill="edge") < 1)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = (cumsum(ind2) - shift(cumsum(ind2), -10, fill="edge") < -5)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = (cumsum(ind2) - shift(cumsum(ind2), -100, fill="edge") < 1)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = (cumsum(ind2) - shift(cumsum(ind2), -100, fill="edge") < -50)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
#sign changes....
#now correlation?
bapply(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100))
bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100))
plot(sort(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100))))
plot(density(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100))))
plot(abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100))))
plot(sort(abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))))
(abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100))))
(abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]"
repeat((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", each = 100)
rep(abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", each = 100)
rep( (abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", each = 100)
inflate
resample
out = 1:10
out
dim(out) = c(2,5)
out
expand
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/helper.R")
(abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]"
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", length(ind)
)
source("C:/Users/zhou/PortableGit/ReadGenea/Junk/helper.R")
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", length(ind)
)
ind
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = 1
ind = ind2
ind
length(ind)
length(ind2)
nrow(tmp2)
ind = 1
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90)
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, pch = ".", cex = 2)
points(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, pch = ".", cex = 2)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", length(ind2))
points(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, pch = ".", cex = 2)
points(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(0*180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.2]", length(ind2))
points(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(0*180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +0*180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(0*180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +0*180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
tmp2 = get.intervals(halfday2, "16:00", "19:00" , incl.date=T)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.2]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
tmp2 = get.intervals(halfday2, "16:00", "20:00" , incl.date=T)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.2]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind
(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind
expand(bapplyc.basic((-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind, 100, mad), nrow(tmp2))
plot(expand(bapplyc.basic((-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind, 100, mad), nrow(tmp2)))
(expand(bapplyc.basic((-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind, 100, mad), nrow(tmp2)) -> mads)
(expand(bapplyc.basic((-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind, 100,sd), nrow(tmp2)) -> sds)
plot(mads[ind!= 0])
plot(mads[ind!= 0], type = "l")
plot(sds[ind!= 0], type = "l")
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
par(mar = c(2,2,2,2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(constrain(sds, 0.05, Inf), type = "l", log="y")
lines(constrain(mads, 0.05, Inf), type = "l", log="y", col=2)
sds[!ind] = NA
mads[!ind] = NA
plot(constrain(sds, 0.05, Inf), type = "l", log="y")
?lines
?plot
?na.approx
approx(sds)
approx(x = 1:length(sds),sds)
length(sds)
?approx
approx(xout = 1:length(sds),sds)
plot(approx(xout = 1:length(sds),sds), type="l")
plot(approx(xout = 1:length(sds),sds), type="l", log = "y")
lines(approx(xout = 1:length(sds),mads), type="l", log = "y", col=2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(approx(xout = 1:length(sds),log(sds)), type="l")
lines(approx(xout = 1:length(sds),log(mads)), type="l", log = "y", col=2)
tmp2 = get.intervals(halfday2, "19:20", "20:00" , incl.date=T)
dev.new();par(mfrow = c(2,1), mar = 2*c(1,1,1,1))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = 1
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
tmp2[1,1]
which(halfday2$dat[,1] == tmp2[1,1])
which(halfday2$dat[,1] == max(tmp2[,1]))
lines(times2(tmp2[,1]), halfday2$dat[ 2009351:2249350, 7] * 2)
ind = 1
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((abs(bapplyc.basic(-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, 100, function(t) cor(t, 1:100)))) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
lines(times2(tmp2[,1]), conv01(halfday2$dat[ 2009351:2249350, 7]) * 50)
dev.new();par(mfrow = c(2,1), mar = 2*c(1,1,1,1))
history(43000)
(expand(bapplyc.basic((-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind, 100, mad), nrow(tmp2)) -> mads)
(expand(bapplyc.basic((-acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90) * ind, 100,sd), nrow(tmp2)) -> sds)
sds[!ind] = NA
mads[!ind] = NA
plot(approx(xout = 1:length(sds),log(sds)), type="l")
lines(approx(xout = 1:length(sds),log(mads)), type="l", log = "y", col=2)
plotsphere(halfday2, "19:25", 20)
plotsphere(halfday2, "19:25:40", 20)
plotsphere(halfday2, "19:26:20", 20)
plotsphere(halfday2, "19:27:20", 20)
plotsphere(halfday2, "19:28:20", 20)
plotsphere(halfday2, "19:30:00", 20)
plotsphere(halfday2, "17:10:00", 20)
plotsphere(halfday2, "19:34:00", 20)
plotsphere(halfday2, "19:34:40", 20)
plotsphere(halfday2, "19:33:40", 60)
plotsphere(halfday2, "19:49:00", 60)
t
t = 1:100
t = scale(t)
cbind(t, t, scale(rnorm(100)))
xt = cbind(t, t, scale(rnorm(100)))
xt
cov(t, xt)
(cov(t, xt)/ sd(t))^2 + sum(sd(xt)^2)
sum((cov(t, xt)/ sd(t))^2) + sum(sd(xt)^2)
sum((cov(t, xt)/ sd(t))^2) / sum(sd(xt)^2)
sqrt(sum((cov(t, xt)/ sd(t))^2) / sum(sd(xt)^2))
xt = cbind(t, scale(t +rnorm(100)), scale(t +rnorm(100)))
sum((cov(t, xt)/ sd(t))^2) / sum(sd(xt)^2)
xt = cbind(t, scale(t +scale(rnorm(100))), scale(t +scale(rnorm(100))))
sum((cov(t, xt)/ sd(t))^2) / sum(sd(xt)^2)
sd(1:100)
sqrt(50)
sqrt(25)/ sd(1:100)
var(1:100)
var(1:100) * 99
sqrt(var(1:100))
bapply
bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4])))
bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))) / var(1:100)
plot(density(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))) / var(1:100)))
dev.new()
plot(sort(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))) / var(1:100)))
t
t = 201:300
 sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))
var(1:100)
which.max((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))) / var(1:100)))
t = 88201:88300
 sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))
cov(1:100, tmp2[t, 2:4])
cov(1:100, tmp2[t, 2:4]) / sd(1:100)
(cov(1:100, tmp2[t, 2:4]) / sd(1:100))^2
sum((cov(1:100, tmp2[t, 2:4]) / sd(1:100))^2)
sd(tmp2[t, 2:4])^2
sum(sd(tmp2[t, 2:4])^2)
sum((cov(1:100, tmp2[t, 2:4]) / sd(1:100))^2)
sum((cov(1:100, tmp2[t, 2:4])^2)
)
sum((cov(1:100, tmp2[t, 2:4])^2)) / var(1:100)
 sum(cov(1:100, tmp2[t, 2:4])^2) / sum(var(tmp2[t, 2:4]))
sum(var(tmp2[t, 2:4]))
(sd(tmp2[t, 2:4]))
(sd(tmp2[t, 2:4]))^2
sum((sd(tmp2[t, 2:4]))^2)
(sd(tmp2[t, 2:4]))^2
(var(tmp2[t, 2:4]))
?var
(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100))
plot(sort(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)))
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
dev.new();par(mfrow = c(2,1), mar = 2*c(1,1,1,1))
ind = 1
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
#3d explained variance
tmp2 = get.intervals(halfday2, "16:30", "18:00", incl = T)
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.2]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = 1
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
dev.new()
tmp2 = get.intervals(halfday2, "16:30", "20:00", incl = T)
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.2]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
ind = expand((bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(cov(1:100, tmp2[t, 2:4])^2) / sum(sd(tmp2[t, 2:4])^2)) / var(1:100)) %bq% "[0, 0.5]", nrow(tmp2))
plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl(180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
bapplyc.basic(1:nrow(tmp2), 100, function(t) sum(sd(tmp2[t, 2:4])^2)
)
sds = expand(bapplyc.basic(1:nrow(tmp2), 100, function(t) sum(sd(tmp2[t, 2:4])^2)), nrow(tmp2))
sds = expand(bapplyc.basic(1:nrow(tmp2), 100, function(t) sqrt(sum(sd(tmp2[t, 2:4])^2))), nrow(tmp2))
dev.new()
sds[!ind] = NA
plot(sds, type = "l", lwd = 2)
plot(times2(tmp2[,1]),sds, type = "l", lwd = 2)
plot(times2(tmp2[,1]),log(sds), type = "l", lwd = 2)
plot(times2(tmp2[,1]),approx(log(sds), xout = 1:nrow(tmp2)), type = "l", lwd = 2)
plot(times2(tmp2[,1]),approx(log(sds), xout = 1:nrow(tmp2))$y, type = "l", lwd = 2)
#this just might work!
stftobj = stft.da(halfday2, "16:30", "20:00", svm = T)
stftobj = stft.da(halfday2, "16:30", "20:00"
)
stftobj = stft.da(halfday2, "16:30", "20:00")
start
end
length
Q
stftobj = stft.da(halfday2, "16:30", end="20:00")
stftobj = stft.da(halfday2, start = "16:30", "20:00", svm = T)
end
Q
stftobj = stft.da(halfday2, start = "16:30", end = "20:00", svm = T)
end
start
time.format
Q
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/stftmod.R")
stftobj = stft.da(halfday2, start = "16:30", end = "20:00", svm = T)
dev.new()
plot(stftobj)
plot(stftobj, topthresh = 10, mode = "pval")
plot(stftobj, topthresh = 10, mode = "pval", reassign = F)
stftobj = stft.da(halfday2, start = "16:30", end = "20:00", svm = T, reassign = F, win = 6000)
plot(stftobj, topthresh = 10, mode = "pval", reassign = F)
str(halfday2)
class(list())
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/util.R")
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/util.R")
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
dev.new()
positionals(halfday2, "7:00", "10:00")
positionals(halfday2, "7:00", "10:00", filter= 0)
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
positionals(halfday2, "7:00", "10:00", filter= 0)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
?legend
??ring
seq(quantile(tmp2[,1], 0, 0.2), len = 20)
points(times2(seq(quantile(tmp2[,1], 0, 0.2), len = 20)), 95, pch = "|")
points(times2(seq(quantile(tmp2[,1], 0, 0.2), len = 20)), rep(95, 20), pch = "|")
quantile
?quantile
?quantile
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 20)), rep(95, 20), pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 20)), rep(95, 20), col = hcl(seq(0, 360, len = 20)) pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 20)), rep(95, 20), col = hcl(seq(0, 360, len = 20)), pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 200)), rep(95, 200), col = hcl(seq(0, 360, len = 200)), pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 256)), rep(95, 256), col = hcl(seq(0, 360, len = 256)), pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 256)), rep(95, 256), col = hcl(seq(360:0, len = 256)), pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 256)), rep(95, 256), col = hcl(seq(360,0, len = 256)), pch = "|")
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0, col=hcl(0:36 * 10))
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0, col=hcl(0:6 * 60))
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0, col=hcl(0:3 * 120))
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 256)), rep(95, 256), col = hcl(seq(360,0, len = 256)), pch = "|")
points(times2(seq(tmp2[1,1] , quantile(tmp2[,1], 0.2), len = 361) )-> tmp, rep(95, 361), col =col[ floor( length(col)* seq(0.999, 0 , len = 361)) +1 ] , pch = "|")
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
par(mfrow = c(3,10))
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
par(mfrow = c(3,1))
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 1)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 2)
dim(tmp2)
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 1)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 2)
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
source("C:/Users/zhou/PortableGit/ReadGenea/ReadGenea/R/positionals.R")
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 1)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 2)
59/175
y
t
t = 1:1000
y = t^2
cor(y[1:999], y[1:999 + 1])
y = scale(t^2) + rnorm(1000)
cor(y[1:999], y[1:999 + 1])
y = scale(t^3) + rnorm(1000)
cor(y[1:999], y[1:999 + 1])
y = scale(sin(t)) + rnorm(1000)
cor(y[1:999], y[1:999 + 1])
plot(y)
y = scale(sin(t/500)) + rnorm(1000)
plot(y)
y = scale(sin(t/50)) + rnorm(1000)
plot(y)
cor(y[1:999], y[1:999 + 1])
y = scale(sin(t/50)) + rnorm(1000)
cor(y[1:999], y[1:999 + 1])
 positionals(halfday2, "7:00", "10:00", filter= 2)
positionals
dev.new()
par(mfrow = c(3,1))
par(mar = c(1,1,1,1))
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l")
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl( sign(-tmp2[,2]) * 180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
dim(tmp2)
tmp3=  bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9)))
head(tmp3)
head(tmp2)
history(2323)
tmp2 = positionals(halfday2, "7:00", "10:00", filter= 0)
fillplots()
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l")
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl( sign(-tmp2[,2]) * 180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
tmp2 = positionals(halfday2, "16:40", "20:00", filter= 0)
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l")
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
tmp2 = positionals(halfday2, "19:10", "21:10", filter= 0)
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
repeatplot(bapply( apply(tmp2[,-1] ,2, function(t) diff(diff(t))^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar =1, col = 1:5, type="l", log="y")
repeatplot(bapply( rowSums(apply(tmp2[,-1] ,2, function(t) diff(diff(t)))^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar =1, col = 1:5, type="l", log="y")
repeatplot(bapply( apply(tmp2[,-1] ,2, function(t) diff(diff(t))^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar =1, col = 1:5, type="l", log="y")
tmp2 = positionals(halfday2, "19:10", "21:10", filter= 0)
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 61), type = "l")
par(mar = c(1,2,1,1))
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 61), type = "l")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 61), type = "l")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 61), type = "l", ylab  ="")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 61), type = "l", ylab  ="")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 21), type = "l", ylab  ="")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 11), type = "l", ylab  ="")
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 11), type = "l", ylab  ="")
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl( sign(-tmp2[,2]) * 180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
 plot(times2(tmp2[,1]), -acos(tmp2[,3] / sqrt(rowSums(tmp2[,-1]^2)) ) *180/pi +90, col = hcl( sign(-tmp2[,2]) * 180 *acos(-tmp2[,4] / sqrt(rowSums(tmp2[,-c(1,3)]^2)))/pi +180 , alpha = ind ), ylim = c(-90, 90), xlab = "", ylab="", pch=".", cex= 2); abline(h = c(-2:2) * 45, lty= 2)
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
repeatplot( bapply(rowSums(apply(tmp2[,-1], 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 11), type = "l", ylab  ="", ylim = c(0, 0.4))
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 11), type = "l", ylab  ="", ylim = c(0, 0.4))
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov( diff(tmp2[t[1:99], 2:4]), diff(tmp2[t[2:100], 2:4])))^2) / sum(sd(diff(tmp2[t, 2:4]))^2)^2), 1), type = "l", ylab  ="", ylim = c(0, 0.4))
difftmp2 = apply(tmp2, 2, diff); plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) sum(diag(cov(difftmp2[t[1:99], 2:4], difftmp2[t[2:100], 2:4]))^2)/sum(sd(difftmp2[t[1:99], 2:4])^2 * sd(difftmp2[t[2:100], 2:4])^2)), 11, type="l", ylab="", ylim = c(0, 0.5))
)
difftmp2 = apply(tmp2, 2, diff); plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) sum(diag(cov(difftmp2[t[1:99], 2:4], difftmp2[t[2:100], 2:4]))^2)/sum(sd(difftmp2[t[1:99], 2:4])^2 * sd(difftmp2[t[2:100], 2:4])^2)), 11), type="l", ylab="", ylim = c(0, 0.5))
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
difftmp2 = apply(tmp2, 2, diff); plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) sum(diag(cov(difftmp2[t[1:99], 2:4], difftmp2[t[2:100], 2:4]))^2)/sum(sd(difftmp2[t[1:99], 2:4])^2 * sd(difftmp2[t[2:100], 2:4])^2)), 11), type="l", ylab="", ylim = c(0, 0.5))
1:100
t = 1:100
cov(difftmp2[t[1:99], 2:4], difftmp2[t[2:100], 2:4])
 sum(diag(cov(difftmp2[t[1:99], 2:4], difftmp2[t[2:100], 2:4]))^2
)
diag(cov(difftmp2[t[1:99], 2:4], difftmp2[t[2:100], 2:4]))
diag(cov(difftmp2[t[1:99], 2], difftmp2[t[2:100], 2]))
(cov(difftmp2[t[1:99], 2], difftmp2[t[2:100], 2]))
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, cor(difftmp2[t[1:99]], difftmp2[t[2:100]])), 11)
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, cor(difftmp2[t[1:99],2], difftmp2[t[2:100],2]) ), 11), type="l", ylim = c(0,0.5))
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) cor(difftmp2[t[1:99],2], difftmp2[t[2:100],2]) ), 11), type="l", ylim = c(0,0.5))
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) cor(difftmp2[t[1:99],2], difftmp2[t[2:100],2]) ), 11), type="l", ylim = c(-0.5,0.5))
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) cor(difftmp2[t[1:99],2], difftmp2[t[2:100],2]) ), 1), type="l", ylim = c(-0.5,0.5))
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
tmp2 = positionals(halfday2, "18:10", "18:20", filter=0)
tmp2[,2]
plot(diff(tmp2[,2]))
plot( diff(tmp2[,2]), shift(diff(tmp2[,2]),1, fill="edge") )
plot( (tmp2[,2]), shift((tmp2[,2]),1, fill="edge") )
ar(tmp2[,2],order = 10)
ar(diff(tmp2[,2]),order = 10)
ar(diff(tmp2[,2]),order = 100)
ar(diff(tmp2[,2]),order = 10)
plot(ar(diff(tmp2[,2]),order = 10))
summary(ar(diff(tmp2[,2]),order = 10))
tmp2 = rnorm(9000);plot( diff(tmp2[,2]), shift(diff(tmp2[,2]),1, fill="edge") )
tmp2[,2]  = rnorm(nrow(tmp2));plot( diff(tmp2[,2]), shift(diff(tmp2[,2]),1, fill="edge") )
nrow(tmp2)
dim(tmp2)
tmp2
tmp2 = rnorm(9000);plot( diff(tmp2), shift(diff(tmp2),1, fill="edge") )
tmp2 = rnorm(9000);plot( diff(tmp2[,2]), shift(diff(tmp2[,2]),2, fill="edge") )
tmp2 = rnorm(9000);plot( diff(tmp2), shift(diff(tmp2),2, fill="edge") )
tmp2 = positionals(halfday2, "18:10", "18:20", filter=0)
plot( diff(tmp2[,2]), shift(diff(tmp2[,2]),2, fill="edge") )
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) cor(difftmp2[t[1:98],2], difftmp2[t[3:100],2]) ), 1), type="l", ylim = c(-0.5,0.5))
plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) cor(difftmp2[t[1:98],2], difftmp2[t[3:100],2]) ), 11), type="l", ylim = c(-0.5,0.5))
difftmp2 = apply(tmp2, 2, diff); plot(runmed(bapply.basic( 1: nrow(difftmp2), 100, function(t) sum(diag(cov(difftmp2[t[1:98], 2:4], difftmp2[t[3:100], 2:4]))^2)/sum(sd(difftmp2[t[1:98], 2:4])^2 * sd(difftmp2[t[3:100], 2:4])^2)), 11), type="l", ylab="", ylim = c(0, 0.5))
plot(  runmed(bapplyc.basic(1: nrow(tmp2), 100 , function(t) sum(diag(cov(tmp2[t[1:99], 2:4], tmp2[t[2:100], 2:4]))^2) / sum(sd(tmp2[t, 2:4])^2)^2), 11), type = "l", ylab  ="")
repeatplot( bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l")
repeatplot( bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l")
repeatplot( bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))), mar = 1, col=1:5, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) , mar = 2, col=1:5, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0,0.1, 0.25, 0.5, 0.75, 0.9,1))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.001,0.1, 0.25, 0.5, 0.75, 0.9,0.999))),1, function(t) runmed(t, 11) ), mar = 2, col=1:7, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.001,0.1, 0.25, 0.5, 0.75, 0.9,0.999))),1, function(t) runmed(t, 11) ), mar = 2, col=1:7, type="l", log = "y")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, diff)^2), 100, function(t) quantile(t, c(0.001,0.1, 0.25, 0.5, 0.75, 0.9,0.999))),1, function(t) runmed(t, 11) ), mar = 2, col=1:7, type="l",)
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
par("usr")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y", ylim = c( 10^(-2.30278), 10^1.787761))
repeatplot
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )), 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y", ylim = c( 10^(-2.30278), 10^1.787761), lims = F)
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) )), 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y", ylim = c( 10^(-2.30278), 10^1.787761), lims = F)
par(mar = c(2,2,0.5,1)
)
tmp2 = positionals(halfday2, "16:30", "21:20", filter=0)
tmp2 = positionals(halfday2, "20:40", "21:00", filter=0)
plotsphere(halfday2, "20:40", "21:00", filter=0)
plotsphere(halfday2, "20:40", "21:00")
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) )), 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y", ylim = c( 10^(-2.30278), 10^1.787761), lims = F)
repeatplot( apply(bapply(rowSums(apply( apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) )), 2, function(r) diff(r) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y", ylim = c( 10^(-2.30278), 10^1.787761), lims = F)
 repeatplot( apply(bapply(rowSums(apply(     apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) ))    , 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
 repeatplot( apply(bapply(rowSums(apply(     apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) ))    , 2, function(r) diff(diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l", log = "y")
 repeatplot( apply(bapply(rowSums(apply(     apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) ))    , 2, function(r) (diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l", log = "y")
cleaned =  apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) )) 
plot(cleaned[,1])
plot(diff(cleaned[,1]))
plot(diff(diff(cleaned[,1])))
plot(tmp2[,2])
subs(tmp2, 0.3,0.9)
 repeatplot( apply(bapply(rowSums(apply(     apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) ))    , 2, function(r) (diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l", log = "y")
apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) ))
dim(apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )))
(apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )))
(apply(tmp2[,-1],2, function(t) as.vector(bapply(t, 100 , function(s) drop(scale(s)) ))))
(apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s)) )))
(apply(tmp2[,-1],2, function(t) as.vector(bapply(t, 100 , function(s) drop(scale(s)) ))))
dim(tmp2)
dim(apply(tmp2[,-1],2, function(t) as.vector(bapply(t, 100 , function(s) drop(scale(s)) ))))
bapply(tmp2[,2], 100, function(s) drop(scale(s)))
sd(bapply(tmp2[,2], 100, function(s) drop(scale(s))))
as.vector(bapply(tmp2[,2], 100, function(s) drop(scale(s))))
(apply(tmp2[,-1],2, function(t) as.vector(bapply(t, 100 , function(s) drop(scale(s)) ))))[,1]
(apply(tmp2[,-1],2, function(t) as.vector(bapply(t, 100 , function(s) drop(scale(s)) ))))[,1]- as.vector(bapply(tmp2[,2], 100, function(s) drop(scale(s))))
sum(((apply(tmp2[,-1],2, function(t) as.vector(bapply(t, 100 , function(s) drop(scale(s)) ))))[,1]- as.vector(bapply(tmp2[,2], 100, function(s) drop(scale(s)))))^2)
sum(((apply(tmp2[,-1],2, function(t) (bapply(t, 100 , function(s) drop(scale(s)) ))))[,1]- as.vector(bapply(tmp2[,2], 100, function(s) drop(scale(s)))))^2)
 repeatplot( apply(bapply(rowSums(apply(     apply(tmp2[,-1],2, function(t) bapply(t, 100 , function(s) drop(scale(s, scale=mad(s))) ))    , 2, function(r) (diff(r)) )^2), 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l")
nrow(tmp2)
tmp2 = positionals(halfday2, "20:40", "21:00", filter=0)
tmp2 = positionals(halfday2, "20:45", 30, filter=0)
plotsphere(halfday2, "20:45", 30)
plotsphere(halfday2, "20:45", 1)
get.intervals(halfday2, "20:45", 1)
scale(get.intervals(halfday2, "20:45", 1))
apply(scale(get.intervals(halfday2, "20:45", 1)),2 , diff)
plot3d(apply(scale(get.intervals(halfday2, "20:45", 1)),2 , diff))
plotsphere(apply(scale(get.intervals(halfday2, "20:45", 1)),2 , diff))
svm = rowSums(tmp2[,-1]^2)
 repeatplot( apply(bapply( as.vector(bapply(svm, 100,   function(r) (diff( scale(r , scale = mad(r)))) ))  , 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
svm = rowSums(tmp2[,-1]^2)
 repeatplot( apply(bapply( abs(diff(as.vector(bapply(svm, 100,   function(r) (( scale(r , scale = mad(r)))) ))))  , 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 11) ), mar = 2, col=1:5, type="l", log = "y")
 repeatplot( apply(bapply( abs(diff(as.vector(bapply(svm, 100,   function(r) (( scale(r , scale = mad(r)))) ))))  , 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l", log = "y")
tmp2 = positionals(halfday2, "20:30", "21:00", filter=0)
tmp2 = positionals(halfday2, "20:30", "21:00", filter=0)
svm = rowSums(tmp2[,-1]^2)
 repeatplot( apply(bapply( abs(diff(as.vector(bapply(svm, 100,   function(r) (( scale(r , scale = mad(r)))) ))))  , 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l", log = "y", ylim=c(0.01,10), lim = F)
tmp2 = positionals(halfday2, "16:30", "21:00", filter=0)
tmp2 = positionals(halfday2, "16:30", "21:00", filter=0)
svm = rowSums(tmp2[,-1]^2)
 repeatplot( apply(bapply( abs(diff(as.vector(bapply(svm, 100,   function(r) (( scale(r , scale = mad(r)))) ))))  , 100, function(t) quantile(t, c(0.1, 0.25, 0.5, 0.75, 0.9))),1, function(t) runmed(t, 1) ), mar = 2, col=1:5, type="l", log = "y", ylim=c(0.01,10), lim = F)
history(3434)

